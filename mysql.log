20051228
mysql> alter table pknots rename to pknots_old;
Query OK, 0 rows affected (0.05 sec)

mysql> alter table pknots_temp1 rename to pknots;
Query OK, 0 rows affected (0.04 sec)


20051222
select
round(
    instr(g.mrna_seq,p.sequence)
    - p.start
    - 7
    + round(instr( p.parsed, trim(LEADING ". " from p.parsed) ),0) / 2
    - .5
,0) as spacer,
    count(p.id) as number
from genome as g, pknots as p
where p.genome_id = g.id
group by spacer
order by spacer asc;


20051220
mysql> update
    ->     pknots_temp1 as p,
    ->     genome as g
    -> set
    ->     p.genome_id = g.id
    -> where
    ->     p.accession = g.accession
    -> ;
Query OK, 0 rows affected (3.39 sec)
Rows matched: 76340  Changed: 0  Warnings: 0

20051219

insert into pknots_temp1 
select distinct
         a.*
     from
         pknots as a
     where
         a.seqLength = (
             select max(seqLength)
             from pknots
             where 
                 accession = a.accession and
                 slipsite = a.slipsite and
                 start = a.start and 
                 pairs = a.pairs and 
                 barcode = a.barcode and
                 abs(round(mfe,2) - round(a.mfe,2)) < 5    
        ) 
     group by 
         a.accession,
         a.start,
         a.slipsite,
         a.pairs,
         a.seqLength
     ;
Query OK, 80208 rows affected (7 min 15.03 sec)
Records: 80208  Duplicates: 0  Warnings: 0

create temporary table tempid ( id int );

insert into tempid (id)
select a.id
from pknots_temp1 as a, pknots_temp1 as b 
where
    a.id != b.id and 
    a.accession = b.accession and 
    a.start = b.start and 
    INSTR(
        a.parsed,
        trim(TRAILING ' .' from b.parsed)
    )!= 0 and
    LEFT(a.parsed,length(trim(TRAILING ' .' from b.parsed))) = trim(TRAILING ' .' from b.parsed) 
order by a.id;
Query OK, 3957 rows affected (1 min 3.36 sec)
Records: 3957  Duplicates: 0  Warnings: 0

delete p.*,t.* from pknots_temp1 as p, tempid as t where p.id = t.id;
Query OK, 7825 rows affected (1.16 sec)
